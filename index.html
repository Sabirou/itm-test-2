<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portail QHSE - Brignoles</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;900&family=Rajdhani:wght@500;700;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --primary: #E2001A;
            --bg-deep: #020203;
        }
        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-deep);
            color: white;
            overflow: hidden;
            height: 100vh;
        }
        .font-rajdhani { font-family: 'Rajdhani', sans-serif; }
        
        /* Grid background effect */
        .bg-grid {
            position: fixed;
            inset: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 60px 60px;
            transform: perspective(1000px) rotateX(60deg) translateY(-150px) translateZ(-100px);
            mask-image: linear-gradient(to bottom, transparent, black, transparent);
            z-index: -1;
            opacity: 0.3;
        }

        .puzzle-piece {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .puzzle-piece:hover {
            transform: translateY(-5px) scale(1.02);
            filter: brightness(1.1);
            z-index: 10;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        .modal-enter { animation: modalFade 0.3s ease-out; }
        @keyframes modalFade {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar Desktop -->
        <aside class="hidden lg:flex w-72 flex-col glass border-r border-white/10 z-20">
            <div class="p-8 border-b border-white/10">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-[#E2001A] rounded-lg flex items-center justify-center shadow-[0_0_15px_rgba(226,0,26,0.4)]">
                        <i data-lucide="layout-grid" class="text-white w-6 h-6"></i>
                    </div>
                    <div>
                        <h1 class="font-rajdhani font-black text-lg uppercase leading-none">Brignoles</h1>
                        <span class="text-[10px] text-zinc-500 font-bold tracking-widest uppercase">Logistique & QHSE</span>
                    </div>
                </div>
            </div>

            <nav class="flex-1 p-4 space-y-2 overflow-y-auto custom-scrollbar">
                <button onclick="window.location.reload()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-[#E2001A]/10 border-l-4 border-[#E2001A] text-white font-bold transition-all">
                    <i data-lucide="home" class="w-5 h-5"></i>
                    <span>Accueil</span>
                </button>
                
                <div class="pt-4 pb-2 px-4">
                    <span class="text-[10px] text-zinc-600 font-black tracking-widest uppercase">Accès Rapides</span>
                </div>

                <a href="#" onclick="openModal('POI', 'Incendie / POI')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-zinc-400 font-bold hover:bg-white/5 hover:text-white transition-all group">
                    <i data-lucide="flame" class="w-5 h-5 group-hover:text-[#E2001A]"></i>
                    <span>Incendie</span>
                </a>
                <a href="#" onclick="openModal('RETRAIT', 'Retrait Qualité')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-zinc-400 font-bold hover:bg-white/5 hover:text-white transition-all group">
                    <i data-lucide="truck" class="w-5 h-5 group-hover:text-[#E2001A]"></i>
                    <span>Retrait</span>
                </a>
                <a href="#" onclick="openModal('FDS', 'Fiches de Sécurité')" class="flex items-center gap-3 px-4 py-3 rounded-xl text-zinc-400 font-bold hover:bg-white/5 hover:text-white transition-all group">
                    <i data-lucide="flask-conical" class="w-5 h-5 group-hover:text-[#E2001A]"></i>
                    <span>FDS</span>
                </a>
            </nav>
            
            <div class="p-4 text-[9px] text-zinc-600 font-bold text-center uppercase tracking-tighter">
                &copy; 2026 Les Mousquetaires
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col relative">
            <header class="h-20 glass border-b border-white/10 flex items-center justify-between px-6 lg:px-12 sticky top-0 z-10">
                <div class="flex items-center gap-4">
                    <i data-lucide="shield-check" class="text-[#E2001A] w-6 h-6 lg:hidden"></i>
                    <h2 class="font-rajdhani text-2xl font-black uppercase tracking-tight">Portail <span class="text-[#E2001A]">QHSE</span></h2>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto custom-scrollbar p-6 lg:p-12">
                <div class="max-w-6xl mx-auto">
                    <div class="text-center mb-12 space-y-4">
                        <span class="inline-block px-4 py-1 rounded-full bg-[#E2001A]/10 text-[#E2001A] text-[10px] font-black tracking-widest uppercase border border-[#E2001A]/20">Dashboard Opérationnel</span>
                        <h3 class="text-4xl lg:text-6xl font-black font-rajdhani tracking-tighter uppercase">ACCÈS <span class="text-[#E2001A]">DOCUMENTS</span></h3>
                    </div>

                    <!-- Puzzle Grid -->
                    <div id="puzzle-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                        <!-- Les pièces seront générées par JS -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Viewer -->
    <div id="doc-modal" class="fixed inset-0 bg-black/90 backdrop-blur-xl z-[100] hidden items-center justify-center p-4">
        <div class="w-full max-w-[95vw] h-[90vh] glass rounded-3xl overflow-hidden flex flex-col modal-enter">
            <div class="p-6 border-b border-white/10 flex items-center justify-between bg-black/40">
                <div class="flex items-center gap-4">
                    <div class="p-2 rounded-lg bg-[#E2001A]/20 text-[#E2001A]">
                        <i data-lucide="file-text" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h2 id="modal-title" class="font-rajdhani text-xl font-black uppercase tracking-tight">Documents</h2>
                        <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest">Base de données Brignoles</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="open-new-tab" class="hidden sm:flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 hover:bg-[#E2001A] transition-all text-xs font-bold uppercase">
                        <i data-lucide="external-link" class="w-4 h-4"></i>
                        Ouvrir
                    </button>
                    <button onclick="closeModal()" class="w-10 h-10 rounded-full hover:bg-white/10 flex items-center justify-center transition-all">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <div class="flex-1 flex flex-col lg:flex-row overflow-hidden">
                <!-- Sidebar Documents -->
                <div class="w-full lg:w-80 border-r border-white/10 flex flex-col bg-black/20">
                    <div class="p-4 border-b border-white/10">
                        <div class="relative">
                            <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500 w-4 h-4"></i>
                            <input type="text" id="search-docs" placeholder="Rechercher..." class="w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-xl text-sm focus:outline-none focus:ring-1 focus:ring-[#E2001A]">
                        </div>
                    </div>
                    <div id="doc-list" class="flex-1 overflow-y-auto p-4 space-y-2 custom-scrollbar">
                        <!-- Liste générée par JS -->
                    </div>
                </div>

                <!-- Iframe Viewer -->
                <div class="flex-1 bg-zinc-900/50 relative">
                    <div id="viewer-placeholder" class="absolute inset-0 flex flex-col items-center justify-center text-zinc-700 space-y-4">
                        <i data-lucide="file-text" class="w-16 h-16 opacity-10"></i>
                        <p class="font-rajdhani font-black uppercase tracking-widest opacity-20">Sélectionnez un document</p>
                    </div>
                    <iframe id="viewer-iframe" class="w-full h-full border-none hidden" src=""></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <nav class="lg:hidden fixed bottom-0 left-0 right-0 h-16 glass border-t border-white/10 flex items-center justify-around z-50">
        <button onclick="window.location.reload()" class="flex flex-col items-center gap-1 text-[#E2001A]">
            <i data-lucide="home" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase">Accueil</span>
        </button>
        <button onclick="openModal('POI', 'POI')" class="flex flex-col items-center gap-1 text-zinc-500">
            <i data-lucide="flame" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase">POI</span>
        </button>
        <button onclick="openModal('FDS', 'FDS')" class="flex flex-col items-center gap-1 text-zinc-500">
            <i data-lucide="flask-conical" class="w-6 h-6"></i>
            <span class="text-[8px] font-black uppercase">FDS</span>
        </button>
    </nav>

    <script>
        // --- Data ---
        const PIECES = [
            { id: 'PROCEDURES', label: 'Procédures', icon: 'clipboard-list', color: 'from-red-600 to-red-800' },
            { id: 'EVALUATION', label: 'Évaluation', icon: 'target', color: 'from-emerald-500 to-emerald-700' },
            { id: 'REFERENTIELS', label: 'Référentiels', icon: 'book-open', color: 'from-orange-500 to-orange-700' },
            { id: 'PERSONNEL', label: 'Personnel', icon: 'users', color: 'from-zinc-600 to-zinc-800' },
            { id: 'DECHETS', label: 'Déchets', icon: 'recycle', color: 'from-teal-600 to-teal-800' },
            { id: 'INDICATEURS', label: 'Indicateurs', icon: 'bar-chart-3', color: 'from-blue-600 to-blue-800' },
            { id: 'AFFICHAGE', label: 'Affichage', icon: 'monitor', color: 'from-yellow-400 to-yellow-600' },
            { id: 'FORMATION', label: 'Formation', icon: 'graduation-cap', color: 'from-fuchsia-600 to-fuchsia-800' },
            { id: 'AT', label: 'Suivi AT', icon: 'activity', color: 'from-lime-500 to-lime-700' },
            { id: 'REGLEMENTATION', label: 'Règlementation', icon: 'scale', color: 'from-indigo-600 to-indigo-800' },
            { id: 'COORDONNEES', label: 'Plans', icon: 'map-pin', color: 'from-pink-600 to-pink-800' },
            { id: 'AUDIT', label: 'Audit', icon: 'search-code', color: 'from-cyan-500 to-cyan-700' },
            { id: 'INTERVENTION', label: 'Intervention', icon: 'wrench', color: 'from-amber-400 to-amber-600' },
            { id: 'REUNION', label: 'CR Réunion', icon: 'message-square', color: 'from-violet-800 to-indigo-950' },
            { id: 'RETRAIT', label: 'Retrait', icon: 'truck', color: 'from-rose-900 to-red-950' },
            { id: 'POI', label: 'Incendie', icon: 'flame', color: 'from-red-600 to-red-900' },
            { id: 'INCIDENT', label: 'Incident', icon: 'alert-triangle', color: 'from-zinc-300 to-zinc-500' },
            { id: 'FDS', label: 'Fiches Séc.', icon: 'flask-conical', color: 'from-red-700 to-red-950' },
            { id: 'INCIDENT_DOC', label: 'Incident Doc', icon: 'file-text', color: 'from-green-600 to-green-800' },
        ];

        const DRIVE_LINKS = [
            "1hEzOUg9OR24DBdY2eAvBJ1Pa8aNH68GD",
            "1rJaLWE7t4vdD1DY87kuGyhWtP5yf8E1d",
            "1eYQ79fzfVy1izWmBIKpIxtNRJSU0bCiq",
            "1BWzJZ8Cmk0GMKVWwA6WRuqAs7927xjxj",
            "1HIAzCX1hPTtTc9B9T0FQvfRi7pzuLSKY"
        ];

        const DOCUMENTS = DRIVE_LINKS.map((id, i) => ({
            id,
            title: `Document QHSE #${i + 1} - Brignoles`,
            viewUrl: `https://drive.google.com/file/d/${id}/view`,
            previewUrl: `https://drive.google.com/file/d/${id}/preview`
        }));

        let activeDoc = null;

        // --- Logic ---
        function init() {
            const grid = document.getElementById('puzzle-grid');
            grid.innerHTML = PIECES.map((p, i) => `
                <div onclick="openModal('${p.id}', '${p.label}')" class="puzzle-piece group relative aspect-square rounded-2xl p-4 cursor-pointer flex flex-col items-center justify-center text-center gap-3 overflow-hidden border border-white/10 bg-gradient-to-br ${p.color} shadow-2xl">
                    <div class="p-2.5 rounded-xl bg-white/10 backdrop-blur-md group-hover:scale-110 transition-transform duration-500">
                        <i data-lucide="${p.icon}" class="w-8 h-8"></i>
                    </div>
                    <span class="font-rajdhani font-black text-[10px] uppercase tracking-wider leading-tight">${p.label}</span>
                    <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function openModal(id, label) {
            document.getElementById('modal-title').innerText = label;
            document.getElementById('doc-modal').classList.remove('hidden');
            document.getElementById('doc-modal').classList.add('flex');
            renderDocList();
        }

        function closeModal() {
            document.getElementById('doc-modal').classList.add('hidden');
            document.getElementById('doc-modal').classList.remove('flex');
            document.getElementById('viewer-iframe').classList.add('hidden');
            document.getElementById('viewer-placeholder').classList.remove('hidden');
            activeDoc = null;
        }

        function renderDocList(filter = '') {
            const list = document.getElementById('doc-list');
            const filtered = DOCUMENTS.filter(d => d.title.toLowerCase().includes(filter.toLowerCase()));
            
            list.innerHTML = filtered.map(d => `
                <button onclick="selectDoc('${d.id}')" class="w-full text-left p-3 rounded-xl transition-all border ${activeDoc === d.id ? 'bg-[#E2001A] border-[#E2001A] text-white shadow-lg' : 'bg-white/5 hover:bg-white/10 border-white/5 text-zinc-300'}">
                    <div class="font-bold text-xs leading-tight mb-1">${d.title}</div>
                    <div class="text-[9px] opacity-50 uppercase font-black">PDF • ID: ${d.id.substring(0,8)}</div>
                </button>
            `).join('');
        }

        function selectDoc(id) {
            activeDoc = id;
            const doc = DOCUMENTS.find(d => d.id === id);
            const iframe = document.getElementById('viewer-iframe');
            const placeholder = document.getElementById('viewer-placeholder');
            
            placeholder.classList.add('hidden');
            iframe.classList.remove('hidden');
            iframe.src = doc.previewUrl;

            document.getElementById('open-new-tab').onclick = () => window.open(doc.viewUrl, '_blank');
            renderDocList(document.getElementById('search-docs').value);
        }

        document.getElementById('search-docs').addEventListener('input', (e) => {
            renderDocList(e.target.value);
        });

        // Close on ESC
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        init();
    </script>
</body>
</html>